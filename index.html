<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ฟอร์มบันทึกข้อมูลบุคลากร</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6">
                <h1 class="text-2xl font-bold text-white text-center">ฟอร์มบันทึกข้อมูลบุคลากร</h1>
                <p class="text-blue-100 text-center mt-2">กรุณากรอกข้อมูลให้ครบถ้วน</p>
            </div>

            <!-- Form -->
            <form id="personnelForm" class="p-8 space-y-6">
                <!-- วันที่บันทึก -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">วันที่บันทึก</label>
                        <input type="date" id="recordDate" name="recordDate" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                    </div>

                    <!-- อำเภอ -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">อำเภอ</label>
                        <select id="district" name="district" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            <option value="">เลือกอำเภอ</option>
                            <option value="เมืองหนองคาย">เมืองหนองคาย</option>
                            <option value="ท่าบ่อ">ท่าบ่อ</option>
                            <option value="โพนพิสัย">โพนพิสัย</option>
                            <option value="ศรีเชียงใหม่">ศรีเชียงใหม่</option>
                            <option value="สังคม">สังคม</option>
                            <option value="สระใคร">สระใคร</option>
                            <option value="เฝ้าไร่">เฝ้าไร่</option>
                            <option value="รัตนวาปี">รัตนวาปี</option>
                            <option value="โพธิ์ตาก">โพธิ์ตาก</option>
                        </select>
                    </div>
                </div>

                <!-- หน่วยบริการ และ ชื่อ-นามสกุล -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">หน่วยบริการ</label>
                        <input type="text" id="serviceUnit" name="serviceUnit" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="กรอกหน่วยบริการ">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ชื่อ-นามสกุล</label>
                        <input type="text" id="fullName" name="fullName" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="กรอกชื่อ-นามสกุล">
                    </div>
                </div>

                <!-- ตำแหน่ง และ อัตราเลขที่ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ตำแหน่ง</label>
                        <input type="text" id="position" name="position" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="กรอกตำแหน่ง">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">อัตราเลขที่</label>
                        <input type="text" id="rateNumber" name="rateNumber" required
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="กรอกอัตราเลขที่">
                    </div>
                </div>

                <!-- ประเภทตำแหน่ง -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">ประเภทตำแหน่ง (เลือก 1 ข้อ)</label>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="positionType" value="ขรก" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">ขรก.</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="positionType" value="พรก" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">พรก.</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="positionType" value="ลจค" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">ลจค.</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="positionType" value="พกส" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">พกส.</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="positionType" value="เจ้าเหมาบริการ" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">เจ้าเหมาบริการ</span>
                        </label>
                    </div>
                </div>

                <!-- เงินเดือนและค่าตอบแทน -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 border-b border-gray-200 pb-2">เงินเดือนและค่าตอบแทน</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">เงินเดือนปัจจุบัน</label>
                            <input type="number" id="currentSalary" name="currentSalary" min="0" step="0.01"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">พ.ต.ส.</label>
                            <input type="number" id="pts" name="pts" min="0" step="0.01"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ฉ.11</label>
                            <input type="number" id="ch11" name="ch11" min="0" step="0.01"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0.00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ค่าตอบแทนอื่นๆ</label>
                            <input type="number" id="otherCompensation" name="otherCompensation" min="0" step="0.01"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                   placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- ค่าเช่าบ้าน และ ค่าศึกษาบุตร -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ค่าเช่าบ้าน</label>
                        <input type="number" id="houseRent" name="houseRent" min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="0.00">
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ค่าศึกษาบุตร</label>
                        <input type="number" id="childEducation" name="childEducation" min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                               placeholder="0.00">
                    </div>
                </div>

                <!-- รพ.สต.มีความประสงค์ -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">รพ.สต.มีความประสงค์ (เลือก 1 ข้อ)</label>
                    <div class="flex space-x-8">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="transferWish" value="ถ่ายโอน" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">ถ่ายโอน</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" name="transferWish" value="ไม่ถ่ายโอน" required
                                   class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm font-medium text-gray-700">ไม่ถ่ายโอน</span>
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-6 border-t border-gray-200">
                    <button type="submit" id="submitBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-lg hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transform transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="submitText">บันทึกข้อมูล</span>
                        <span id="loadingText" class="hidden">กำลังบันทึก...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Set current date as default
        document.getElementById('recordDate').valueAsDate = new Date();

        // Form submission handler
        document.getElementById('personnelForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingText = document.getElementById('loadingText');
            
            // Show loading state
            submitBtn.disabled = true;
            submitText.classList.add('hidden');
            loadingText.classList.remove('hidden');

            try {
                // Collect form data
                const formData = new FormData(this);
                const data = {};
                
                // Basic fields
                data.recordDate = formData.get('recordDate');
                data.district = formData.get('district');
                data.serviceUnit = formData.get('serviceUnit');
                data.fullName = formData.get('fullName');
                data.position = formData.get('position');
                data.rateNumber = formData.get('rateNumber');
                
                // Position type (set 1 for selected, empty for others)
                const positionType = formData.get('positionType');
                data.khrk = positionType === 'ขรก' ? '1' : '';
                data.phrk = positionType === 'พรก' ? '1' : '';
                data.ljkh = positionType === 'ลจค' ? '1' : '';
                data.pkgs = positionType === 'พกส' ? '1' : '';
                data.contractor = positionType === 'เจ้าเหมาบริการ' ? '1' : '';
                
                // Salary and compensation
                data.currentSalary = formData.get('currentSalary') || '0';
                data.pts = formData.get('pts') || '0';
                data.ch11 = formData.get('ch11') || '0';
                data.otherCompensation = formData.get('otherCompensation') || '0';
                data.houseRent = formData.get('houseRent') || '0';
                data.childEducation = formData.get('childEducation') || '0';
                
                // Transfer wish (set 1 for selected, empty for other)
                const transferWish = formData.get('transferWish');
                data.transfer = transferWish === 'ถ่ายโอน' ? '1' : '';
                data.noTransfer = transferWish === 'ไม่ถ่ายโอน' ? '1' : '';

                // Send to Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbwr4CeSmy1ZzyACebwKwfVuOGm8v26f4eceQ7pmjdYHQyvdu-FqAEOwXsG-HRX1Ou2O7g/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // Show success message
                await Swal.fire({
                    icon: 'success',
                    title: 'บันทึกข้อมูลสำเร็จ!',
                    text: 'ข้อมูลได้ถูกบันทึกลงใน Google Sheet เรียบร้อยแล้ว',
                    confirmButtonText: 'ตกลง',
                    confirmButtonColor: '#3B82F6'
                });

                // Reset form
                this.reset();
                document.getElementById('recordDate').valueAsDate = new Date();

            } catch (error) {
                console.error('Error:', error);
                
                // Show error message
                await Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด!',
                    text: 'ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง',
                    confirmButtonText: 'ตกลง',
                    confirmButtonColor: '#EF4444'
                });
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
            }
        });

        // Number input validation (only allow numbers)
        const numberInputs = document.querySelectorAll('input[type="number"]');
        numberInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                // Remove any non-numeric characters except decimal point
                this.value = this.value.replace(/[^0-9.]/g, '');
                
                // Ensure only one decimal point
                const parts = this.value.split('.');
                if (parts.length > 2) {
                    this.value = parts[0] + '.' + parts.slice(1).join('');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97f6762ff1da731c',t:'MTc1NzkyMTg3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
